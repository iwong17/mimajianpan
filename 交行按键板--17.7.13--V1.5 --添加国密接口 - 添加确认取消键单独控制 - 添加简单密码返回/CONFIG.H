#ifndef _CONFIG_H_
#define _CONFIG_H_

#define KEY_CLOSE	0x80
#define KEY_BEEP_ON	0x01

#define KEYPORT (P1&0xf0) | (P4&0x0f) //定义键盘扫描接口 //wy 17.7.14修改 原为P1

#define LED P0		  //定义数码管显示接口
#define chose0_7 P2	  //定义数码管位选接口

#define OVERTIME 1000

sbit OPEN=P3^5;		   //拆机自毁引脚
sbit chose0 = P2^0;	  //定义数码管位选接口
sbit chose1 = P2^1;	  //0对应第一个数码管而非常规的0键
sbit chose2 = P2^2;	  
sbit chose3 = P2^3;	  //		键盘控制如下图：
sbit chose4 = P2^4;	  //	chose0  chose1	chose2	未定义
sbit chose5 = P2^5;	  //	chose3	chose4	chose5 	'C'
sbit chose6 = P2^6;	  //	chose6	chose7	chose8	'D'
sbit chose7 = P2^7;	  //	 'A'	chose9	 'B'	'E'
sbit chose8 = P3^6;
sbit chose9 = P3^7;
sbit beep = P1^4;	 //蜂鸣器 //wy 17.7.14修改 原为P4^0
sbit seq = P3^4;

unsigned char bdata DATA;	 //通信接、发数据暂存变量
sbit BIT0 = DATA^0;
sbit BIT7 = DATA^7;


unsigned char led_key[10] = {0,1,2,3,4,5,6,7,8,9};	//数码管显示顺序  （作为显示用）	 
unsigned char ledcode[10];							//数码管显示码值  （作为键盘输出）
bit rxflag = 0;		  //接收允许标志	 1为允许
bit seqflag = 0;

bit seqint=0;
bit dotint=0;
bit lagint=0;

unsigned char xdata flag=0;
unsigned char xdata beepflag=0;


/**************函数原型定义***********************/
void GetCode(void);//获取密码
void RecDeal(void);
char TwoToOne(unsigned char *msg,unsigned char length);
char OneToTwo(unsigned char *msg,unsigned char length);
char InitDevice(void);//设备初始化
void Destory_Deal(void);//自毁判断

unsigned char Scankey(void);	    //键盘扫描函数
void Beep(void);		            //蜂鸣器函数
void Sequence(void);	            //数码管乱序函数
void InitTime(unsigned long us);	//定时器0初始化
void Display(unsigned char);	    //数码管显示函数
bit OutOfOrder(void);               //乱序核心算法
bit Comp(unsigned char,unsigned char,unsigned char);//判断函数，判断物理相邻的数码管是否显示相邻
/**************函数原型定义***********************/
														   
unsigned char xdata nowkey=0;

unsigned char xdata cmd[256];
unsigned char xdata cmdlength;
unsigned char xdata keyflag;
unsigned char xdata keycode[16];
unsigned char xdata keylength;
unsigned char xdata maxkeylen;

unsigned char xdata destoryflag=0;	   //拆机自毁标志
unsigned char xdata recoverflag=1;	   //拆机自毁恢复标志
unsigned char xdata enabledestory=0;

unsigned char code KEY[10][8]={	"\x23\x4d\xaa\xd2\xd0\x4e\x9a\xfa",
								"\x90\x9a\xd9\x23\xdf\xac\xcb\xe2",
								"\x43\x20\x0a\xff\xdf\x02\x3a\xbc",
								"\x86\x74\x89\xab\x23\x01\x23\x20",
								"\x02\xa3\xe4\x80\x02\xdf\xaf\xfa",
								"\x00\x1c\x11\x86\x00\x09\xff\xae",
								"\x23\xaa\x4c\xaf\x29\x10\x3f\xde",
								"\x01\x2e\xa0\xc2\xd4\x5d\xf2\x50",
								"\xee\xa2\xdf\x24\x50\x0f\xee\xab",
								"\x88\x79\x20\xd8\x3f\xcc\xa2\x35"};

int code maval[304][5]={  //乱序算法的基址集合，间距为304	  用其他程序生成，方便快捷
{0x01,0x35,0x46,0x87,0x92},{0x01,0x52,0x37,0x98,0x46},{0x01,0x64,0x83,0x75,0x92},
{0x01,0x84,0x73,0x65,0x92},{0x02,0x51,0x97,0x36,0x48},{0x02,0x63,0x81,0x74,0x95},
{0x02,0x74,0x63,0x89,0x51},{0x02,0x85,0x73,0x94,0x16},{0x03,0x61,0x82,0x45,0x97},
{0x03,0x72,0x15,0x96,0x84},{0x03,0x84,0x71,0x69,0x52},{0x04,0x28,0x79,0x15,0x36},
{0x04,0x71,0x82,0x63,0x59},{0x04,0x82,0x63,0x79,0x15},{0x05,0x27,0x94,0x16,0x83},
{0x05,0x38,0x71,0x49,0x62},{0x05,0x74,0x93,0x62,0x81},{0x06,0x24,0x85,0x91,0x37},
{0x06,0x37,0x15,0x94,0x82},{0x06,0x48,0x17,0x25,0x39},{0x07,0x24,0x16,0x95,0x83},
{0x07,0x35,0x28,0x14,0x69},{0x07,0x42,0x91,0x85,0x36},{0x07,0x53,0x42,0x96,0x81},
{0x08,0x31,0x26,0x45,0x97},{0x08,0x41,0x69,0x32,0x75},{0x08,0x52,0x37,0x49,0x16},
{0x08,0x63,0x51,0x92,0x47},{0x09,0x36,0x51,0x87,0x42},{0x09,0x51,0x68,0x32,0x47},
{0x09,0x68,0x53,0x12,0x74},{0x10,0x42,0x69,0x78,0x53},{0x10,0x59,0x28,0x46,0x37},
{0x10,0x74,0x62,0x83,0x95},{0x12,0x48,0x69,0x30,0x75},{0x12,0x68,0x40,0x39,0x75},
{0x12,0x83,0x75,0x04,0x96},{0x13,0x50,0x82,0x76,0x49},{0x13,0x68,0x50,0x42,0x79},
{0x13,0x75,0x62,0x89,0x40},{0x13,0x86,0x50,0x27,0x49},{0x14,0x60,0x82,0x75,0x93},
{0x14,0x73,0x62,0x98,0x05},{0x14,0x83,0x95,0x06,0x27},{0x14,0x97,0x02,0x53,0x68},
{0x15,0x72,0x30,0x49,0x68},{0x15,0x83,0x24,0x97,0x06},{0x15,0x96,0x24,0x80,0x73},
{0x16,0x39,0x40,0x58,0x27},{0x16,0x82,0x03,0x74,0x95},{0x16,0x93,0x25,0x78,0x04},
{0x17,0x36,0x58,0x09,0x24},{0x17,0x49,0x06,0x23,0x85},{0x17,0x59,0x40,0x26,0x38},
{0x18,0x36,0x07,0x25,0x94},{0x18,0x46,0x59,0x23,0x70},{0x18,0x57,0x42,0x09,0x63},
{0x19,0x30,0x58,0x67,0x42},{0x19,0x46,0x52,0x80,0x73},{0x19,0x53,0x68,0x02,0x47},
{0x19,0x64,0x38,0x27,0x05},{0x20,0x41,0x86,0x35,0x97},{0x20,0x57,0x68,0x34,0x19},
{0x20,0x64,0x81,0x75,0x39},{0x20,0x75,0x61,0x83,0x94},{0x21,0x46,0x37,0x98,0x05},
{0x21,0x60,0x48,0x39,0x57},{0x21,0x75,0x80,0x34,0x69},{0x21,0x96,0x47,0x08,0x35},
{0x23,0x59,0x08,0x67,0x14},{0x23,0x74,0x95,0x06,0x18},{0x23,0x95,0x14,0x76,0x80},
{0x24,0x08,0x15,0x37,0x96},{0x24,0x70,0x83,0x65,0x91},{0x24,0x83,0x06,0x95,0x17},
{0x24,0x96,0x71,0x30,0x58},{0x25,0x08,0x16,0x34,0x97},{0x25,0x80,0x71,0x43,0x96},
{0x25,0x93,0x71,0x60,0x48},{0x26,0x04,0x97,0x13,0x58},{0x26,0x49,0x31,0x75,0x80},
{0x26,0x91,0x83,0x54,0x70},{0x27,0x04,0x53,0x81,0x96},{0x27,0x46,0x50,0x89,0x31},
{0x27,0x58,0x93,0x01,0x64},{0x27,0x96,0x15,0x84,0x03},{0x28,0x41,0x69,0x30,0x57},
{0x28,0x53,0x69,0x10,0x74},{0x28,0x69,0x14,0x73,0x05},{0x29,0x50,0x38,0x67,0x14},
{0x29,0x60,0x73,0x54,0x18},{0x29,0x73,0x51,0x80,0x46},{0x30,0x58,0x71,0x69,0x42},
{0x30,0x69,0x48,0x21,0x57},{0x30,0x79,0x85,0x14,0x26},{0x31,0x57,0x82,0x96,0x04},
{0x31,0x68,0x92,0x45,0x07},{0x31,0x75,0x94,0x82,0x06},{0x31,0x92,0x64,0x70,0x85},
{0x32,0x07,0x58,0x41,0x69},{0x32,0x68,0x70,0x51,0x49},{0x32,0x84,0x06,0x95,0x17},
{0x34,0x05,0x68,0x19,0x27},{0x34,0x60,0x28,0x59,0x17},{0x34,0x80,0x61,0x72,0x59},
{0x34,0x97,0x02,0x56,0x81},{0x35,0x08,0x97,0x16,0x24},{0x35,0x71,0x02,0x86,0x94},
{0x35,0x82,0x70,0x49,0x61},{0x35,0x97,0x14,0x06,0x82},{0x36,0x08,0x97,0x14,0x25},
{0x36,0x80,0x95,0x24,0x17},{0x36,0x94,0x25,0x18,0x07},{0x37,0x06,0x25,0x89,0x14},
{0x37,0x19,0x28,0x65,0x04},{0x37,0x94,0x15,0x06,0x28},{0x38,0x06,0x24,0x15,0x97},
{0x38,0x17,0x25,0x96,0x04},{0x38,0x59,0x62,0x41,0x70},{0x39,0x15,0x68,0x04,0x27},
{0x39,0x57,0x28,0x04,0x16},{0x39,0x68,0x42,0x50,0x71},{0x40,0x26,0x57,0x98,0x31},
{0x40,0x63,0x82,0x71,0x59},{0x40,0x79,0x25,0x38,0x16},{0x41,0x60,0x58,0x27,0x39},
{0x41,0x72,0x63,0x90,0x85},{0x41,0x82,0x95,0x06,0x37},{0x41,0x96,0x75,0x20,0x38},
{0x42,0x60,0x71,0x83,0x95},{0x42,0x71,0x50,0x68,0x39},{0x42,0x83,0x51,0x79,0x60},
{0x42,0x96,0x85,0x03,0x17},{0x43,0x17,0x86,0x02,0x95},{0x43,0x71,0x95,0x82,0x06},
{0x43,0x92,0x16,0x87,0x05},{0x45,0x08,0x27,0x36,0x19},{0x45,0x29,0x07,0x16,0x38},
{0x45,0x82,0x96,0x01,0x37},{0x46,0x03,0x85,0x92,0x71},{0x46,0x18,0x25,0x07,0x93},
{0x46,0x29,0x07,0x58,0x31},{0x46,0x91,0x27,0x35,0x08},{0x47,0x03,0x52,0x91,0x86},
{0x47,0x16,0x53,0x90,0x82},{0x47,0x28,0x59,0x60,0x31},{0x48,0x02,0x17,0x56,0x39},
{0x48,0x15,0x39,0x76,0x20},{0x48,0x26,0x17,0x95,0x03},{0x48,0x69,0x30,0x51,0x72},
{0x49,0x25,0x37,0x18,0x06},{0x49,0x61,0x53,0x80,0x72},{0x49,0x72,0x30,0x61,0x58},
{0x50,0x28,0x79,0x13,0x64},{0x50,0x39,0x71,0x62,0x48},{0x50,0x81,0x72,0x43,0x69},
{0x51,0x38,0x46,0x09,0x27},{0x51,0x79,0x30,0x26,0x84},{0x51,0x92,0x46,0x87,0x03},
{0x52,0x06,0x73,0x94,0x81},{0x52,0x74,0x61,0x90,0x83},{0x52,0x84,0x96,0x03,0x17},
{0x52,0x97,0x83,0x06,0x14},{0x53,0x17,0x06,0x48,0x29},{0x53,0x72,0x19,0x48,0x60},
{0x53,0x84,0x06,0x27,0x19},{0x53,0x97,0x81,0x40,0x62},{0x54,0x18,0x96,0x37,0x20},
{0x54,0x73,0x02,0x98,0x61},{0x54,0x93,0x16,0x87,0x20},{0x56,0x17,0x04,0x93,0x82},
{0x56,0x29,0x80,0x41,0x37},{0x56,0x91,0x04,0x82,0x73},{0x57,0x04,0x18,0x29,0x36},
{0x57,0x19,0x04,0x23,0x86},{0x57,0x29,0x40,0x68,0x31},{0x57,0x92,0x13,0x68,0x04},
{0x58,0x04,0x63,0x91,0x72},{0x58,0x19,0x36,0x20,0x47},{0x58,0x30,0x17,0x26,0x49},
{0x59,0x14,0x38,0x27,0x06},{0x59,0x26,0x74,0x10,0x83},{0x59,0x37,0x46,0x12,0x08},
{0x60,0x25,0x38,0x19,0x47},{0x60,0x37,0x49,0x21,0x58},{0x60,0x48,0x37,0x15,0x29},
{0x61,0x30,0x75,0x89,0x24},{0x61,0x47,0x39,0x50,0x28},{0x61,0x83,0x94,0x07,0x25},
{0x61,0x94,0x82,0x73,0x50},{0x62,0x08,0x75,0x34,0x19},{0x62,0x83,0x05,0x17,0x94},
{0x62,0x94,0x83,0x01,0x75},{0x63,0x08,0x17,0x45,0x29},{0x63,0x80,0x71,0x49,0x52},
{0x63,0x92,0x15,0x84,0x70},{0x64,0x05,0x17,0x38,0x29},{0x64,0x18,0x93,0x57,0x02},
{0x64,0x80,0x15,0x23,0x97},{0x64,0x92,0x05,0x78,0x31},{0x65,0x04,0x82,0x91,0x73},
{0x65,0x27,0x39,0x10,0x48},{0x65,0x82,0x13,0x07,0x94},{0x67,0x03,0x25,0x98,0x14},
{0x67,0x20,0x49,0x31,0x58},{0x67,0x39,0x20,0x58,0x41},{0x67,0x95,0x13,0x04,0x82},
{0x68,0x14,0x05,0x92,0x73},{0x68,0x25,0x30,0x79,0x41},{0x68,0x35,0x29,0x70,0x41},
{0x68,0x49,0x31,0x70,0x52},{0x69,0x24,0x37,0x01,0x58},{0x69,0x31,0x75,0x84,0x02},
{0x69,0x42,0x37,0x08,0x15},{0x70,0x29,0x84,0x65,0x13},{0x70,0x41,0x52,0x93,0x86},
{0x70,0x52,0x38,0x41,0x69},{0x71,0x36,0x59,0x28,0x40},{0x71,0x49,0x30,0x65,0x82},
{0x71,0x59,0x68,0x23,0x04},{0x72,0x04,0x93,0x65,0x81},{0x72,0x48,0x60,0x39,0x51},
{0x72,0x59,0x41,0x30,0x86},{0x72,0x96,0x85,0x13,0x04},{0x73,0x14,0x96,0x25,0x80},
{0x73,0x52,0x18,0x09,0x64},{0x73,0x96,0x15,0x84,0x02},{0x74,0x13,0x26,0x90,0x85},
{0x74,0x20,0x96,0x35,0x18},{0x74,0x93,0x05,0x12,0x86},{0x75,0x04,0x83,0x92,0x61},
{0x75,0x19,0x28,0x30,0x46},{0x75,0x30,0x28,0x49,0x16},{0x75,0x93,0x02,0x84,0x61},
{0x76,0x13,0x85,0x94,0x02},{0x76,0x29,0x35,0x18,0x04},{0x76,0x49,0x08,0x23,0x15},
{0x78,0x06,0x25,0x14,0x93},{0x78,0x26,0x19,0x43,0x50},{0x78,0x41,0x39,0x50,0x62},
{0x79,0x14,0x35,0x06,0x28},{0x79,0x25,0x48,0x01,0x63},{0x79,0x36,0x50,0x42,0x81},
{0x79,0x48,0x26,0x10,0x35},{0x80,0x25,0x46,0x37,0x19},{0x80,0x36,0x59,0x27,0x14},
{0x80,0x47,0x62,0x53,0x91},{0x80,0x59,0x42,0x61,0x73},{0x81,0x35,0x96,0x02,0x47},
{0x81,0x46,0x70,0x35,0x29},{0x81,0x57,0x40,0x36,0x29},{0x81,0x69,0x40,0x32,0x75},
{0x82,0x41,0x69,0x70,0x53},{0x82,0x53,0x69,0x70,0x41},{0x82,0x69,0x04,0x73,0x15},
{0x83,0x14,0x06,0x97,0x25},{0x83,0x50,0x91,0x72,0x64},{0x83,0x61,0x70,0x52,0x49},
{0x84,0x06,0x25,0x37,0x19},{0x84,0x19,0x06,0x37,0x25},{0x84,0x60,0x79,0x21,0x35},
{0x85,0x04,0x26,0x17,0x39},{0x85,0x17,0x36,0x20,0x49},{0x85,0x29,0x04,0x73,0x61},
{0x86,0x03,0x15,0x97,0x24},{0x86,0x14,0x93,0x02,0x57},{0x86,0x27,0x04,0x93,0x15},
{0x86,0x39,0x17,0x45,0x02},{0x87,0x04,0x15,0x23,0x96},{0x87,0x24,0x19,0x63,0x50},
{0x87,0x39,0x50,0x21,0x46},{0x87,0x59,0x20,0x46,0x31},{0x89,0x27,0x40,0x51,0x63},
{0x89,0x42,0x57,0x01,0x36},{0x89,0x62,0x40,0x71,0x53},{0x90,0x36,0x71,0x42,0x58},
{0x90,0x52,0x37,0x46,0x18},{0x90,0x71,0x24,0x65,0x83},{0x91,0x37,0x58,0x02,0x64},
{0x91,0x50,0x38,0x46,0x27},{0x91,0x62,0x40,0x78,0x53},{0x91,0x73,0x60,0x52,0x48},
{0x92,0x47,0x68,0x50,0x31},{0x92,0x58,0x60,0x31,0x47},{0x92,0x70,0x53,0x61,0x84},
{0x93,0x16,0x07,0x45,0x28},{0x93,0x57,0x61,0x42,0x80},{0x93,0x68,0x71,0x50,0x42},
{0x94,0x15,0x63,0x78,0x02},{0x94,0x26,0x17,0x38,0x50},{0x94,0x62,0x71,0x50,0x83},
{0x94,0x73,0x25,0x16,0x08},{0x95,0x20,0x17,0x46,0x38},{0x95,0x31,0x27,0x48,0x06},
{0x95,0x72,0x81,0x46,0x30},{0x96,0x18,0x37,0x05,0x24},{0x96,0x30,0x41,0x72,0x85},
{0x96,0x41,0x20,0x57,0x38},{0x97,0x15,0x36,0x08,0x24},{0x97,0x26,0x48,0x10,0x53},
{0x97,0x38,0x50,0x61,0x42},{0x97,0x51,0x30,0x86,0x42},{0x98,0x20,0x14,0x65,0x73},
{0x98,0x36,0x57,0x01,0x42}
};

#endif